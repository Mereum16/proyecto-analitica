<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Predicci√≥n Individual</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{background:linear-gradient(135deg,#e3f2fd,#bbdefb);font-family:Poppins,system-ui}
    .card-wrap{max-width:1300px;margin:30px auto}
    .result-ok{background:#c8e6c9;color:#1b5e20}
    .result-warn{background:#fff3cd;color:#7a5a00}
    .result-bad{background:#ffcdd2;color:#b71c1c}
    .form-label{font-weight:600;color:#0d47a1}
    .title{color:#1565c0;font-weight:800}
    .sticky-footer{position:sticky;bottom:0;background:#fff;border-top:1px solid #eee;padding:12px;border-radius:0 0 12px 12px}
  </style>
</head>
<body>
  <div class="card card-wrap shadow">
    <div class="card-body">
      <h3 class="title text-center mb-4">üß† Predicci√≥n Individual ‚Äì Diagn√≥stico Cl√≠nico</h3>

      <form method="POST" id="formPred" class="row g-3">

        <!-- Sexo (unificado) -->
        <div class="col-md-4">
          <label class="form-label">Sexo</label>
          <select class="form-select" name="sexo" required>
            <option value="1">Masculino</option>
            <option value="0">Femenino</option>
          </select>
        </div>

        <!-- Render din√°mico de TODAS las variables del dataset (excepto male/female y diagnosis) -->
        {% for name, meta in variables_info.items() %}
          {% if name not in ["male","female","diagnosis"] %}
            <div class="col-md-4">
              <label class="form-label">{{ meta.display }}</label>

              {% if meta.type == "binary" %}
                <select class="form-select" name="{{ name }}" required>
                  <option value="1">S√≠</option>
                  <option value="0">No</option>
                </select>

              {% else %}
                <input type="number"
                       class="form-control"
                       name="{{ name }}"
                       step="{{ meta.step }}"
                       min="{{ meta.min }}"
                       max="{{ meta.max }}"
                       placeholder="{{ meta.min }} ‚Äì {{ meta.max }}"
                       required>
              {% endif %}
            </div>
          {% endif %}
        {% endfor %}

        <!-- Modelo -->
        <div class="col-md-4">
          <label class="form-label">Modelo de predicci√≥n</label>
          <select class="form-select" name="modelo" required>
            <option value="rna">Red Neuronal</option>
            <option value="logistica">Regresi√≥n Log√≠stica</option>
          </select>
        </div>

        <div class="col-12 sticky-footer d-flex gap-2 justify-content-center">
          <button class="btn btn-primary px-4" type="submit">üîç Predecir</button>
          <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">‚Üê Volver al inicio</a>
        </div>
      </form>

      <!-- üîπ Bloque de resultado mejorado -->
      {% if resultado %}
      <div class="mt-4 p-3 rounded text-center shadow-sm" 
           style="max-width: 700px; margin: 0 auto; background: #fff;">
        {% if "S√ç" in resultado.mensaje %}
          <h5 class="text-danger fw-bold mb-2">{{ resultado.mensaje }}</h5>
        {% else %}
          <h5 class="text-success fw-bold mb-2">{{ resultado.mensaje }}</h5>
        {% endif %}
      </div>
      {% endif %}

    </div>
  </div>

  <script>
    // Recorte de rango en el cliente (adem√°s del recorte en servidor)
    document.getElementById('formPred').addEventListener('input', (e) => {
      const el = e.target;
      if (el.type === 'number') {
        const min = el.min !== "" ? parseFloat(el.min) : null;
        const max = el.max !== "" ? parseFloat(el.max) : null;
        let val = el.value === "" ? null : parseFloat(el.value);
        if (val !== null) {
          if (min !== null && val < min) val = min;
          if (max !== null && val > max) val = max;
          if (!Number.isNaN(val)) el.value = val;
        }
      }
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const inputs = document.querySelectorAll("input[type='number']");
      inputs.forEach(input => {
        const min = parseFloat(input.min);
        const max = parseFloat(input.max);
        input.addEventListener("input", function() {
          let val = parseFloat(this.value);
          if (!isNaN(val)) {
            if (val < min) this.value = min;
            if (val > max) this.value = max;
          }
        });
      });
    });
  </script>
</body>
</html>